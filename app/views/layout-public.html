<!--
  This is the main layout where you can:
    - change the header and footer
    - add custom CSS and JavaScript
-->

<!-- Extends the prototype kit template which in turn extends the NHS.UK frontend template -->
{% extends "prototype-kit-template.njk" %}

{% block head %}
  <!-- Add your custom CSS or Sass in /app/assets/sass/main.scss -->
  {{ super() }}
  <link href="/css/main.css" rel="stylesheet">
{% endblock %}

<!-- Edit the header -->
<!-- Header code examples can be found at https://service-manual.nhs.uk/design-system/components/header -->
{% block header %}
  {{ header({
    service: {
      text: serviceName,
      href: "/"
    },
  account: {
    items: [
      {
        text: "Florence Nightingale",
        icon: true
      },
      {
        text: "Log out",
        href: "#",
        attributes: {
          "data-toggle": "dialog",
          "data-target": "dialog-signOut",
          "aria-haspopup": "true"
        }
      }
    ]
  }
  }) }}
<br>
<div class="nhsuk-width-container">
 <div class="nhsuk-phase-banner nhsuk-u-margin-bottom-5 no-print">
  		<p class="nhsuk-phase-banner__content">
    		<strong class="nhsuk-tag nhsuk-phase-banner__content__tag">BETA</strong>
    		<span class="nhsuk-phase-banner__text">
      		This is a new service - your
				
				
					<a class="nhsuk-link" target="_blank" rel="noopener" href="https://online1.snapsurveys.com/LSF_TDAE_Banner_Survey?pnm=/student/enrol/course" id="feedback">feedback (opens in a new tab)</a> will help us to improve it.
				

				</span>
  		</p>
		</div>
    {{ backLink({
            "href": "javascript:history.go(-1)",
            "text": "Go back"
        }) }}


<style>
  /* sign out modal */
  .dialog[aria-hidden="false"] {
    opacity: 1;
    visibility: visible;
    z-index: 11;
  }

  .dialog[aria-hidden="true"] {
    opacity: 0;
    visibility: hidden;
  }

  .dialog-cancel {
    display: inline-block;
    font-size: 1em;
    line-height: 1.25;
    margin-right: .78947em;
    padding: .52632em .78947em .26316em;
  }

  .dialog {
    -webkit-box-sizing: border-box;
    -moz-box-sizing: border-box;
    box-sizing: border-box;
    background-color: rgba(0, 0, 0, 0.5);
    height: 100%;
    padding: 15px;
    position: fixed;
    left: 0;
    top: 0;
    right: 0;
    bottom: 0;
    text-align: center;
    width: 100%;
    z-index: 0;
  }

  .dialog:before {
    content: '';
    display: inline-block;
    height: 100%;
    margin-right: -.25em;
    vertical-align: middle;
  }

  .dialog-holder {
    background-color: #fff;
    border: 10px solid #fff;
    display: inline-block;
    margin: auto;
    max-width: 530px;
    position: relative;
    vertical-align: middle;
  }

  .dialog-content {
    outline: none;
    padding: 1em;
    text-align: left;
  }

  @media (max-width : 640px) {
    .dialog-heading {
      font-size: 24px;
      line-height: 1.04167;
    }

    .dialog:before {
      display: none;
    }
  }

  .dialog-close {
    background-color: transparent;
    border: 0 none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 22px;
    margin: auto;
    padding: 0;
    position: absolute;
    top: 5px;
    right: 5px;
    width: 22px;
  }

  .dialog-close:hover svg {
    fill: #7c2855;
  }

  .dialog-close:focus {
    outline: 4px solid #ffeb3b;
    outline-offset: 0;
  }

  .dialog-heading {
    font-size: 36px;
    line-height: 1.11111;
    font-weight: 700;
    text-transform: none;
    margin-top: .625em;
    margin-bottom: .41667em;
  }

  .dialog-close svg {
    fill: #212b32;
    height: 22px;
    width: 22px;
  }
</style>
{% endblock %}

<!-- Edit the footer -->
<!-- Footer code examples can be found at https://service-manual.nhs.uk/design-system/components/footer -->
{% block footer %}
<div class="dialog" id="dialog-signOut" aria-hidden="true">
  <div class="dialog-holder" aria-labelledby="dialog-title-1" aria-describedby="dialog-content-1" role="alertdialog">
    <div class="dialog-content" id="dialog-content-1" role="document" tabindex="0">
      <h1 class="dialog-heading" id="dialog-title-1">Sign out</h1>
      <form class="form">
        <p>This will end your session. Are you sure you want to sign out?</p>
        <div class="dialog-actions">
          <a id="logoutYes" class="nhsuk-button nhsuk-u-margin-right-4" role="button" href="/lsf-public/{{ number }}/sign-in">Yes</a>
          <a id="logoutNo" class="nhsuk-button nhsuk-button--secondary" role="button" href="#">No</a>
        </div>

        <button class="dialog-close" aria-label="close dialog" type="button">
          <svg class="nhsuk-icon nhsuk-icon__close-circle" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false" width="22" height="22">
            <path d="M13.41 12l5.3-5.29a1 1 0 1 0-1.42-1.42L12 10.59 6.71 5.29a1 1 0 0 0-1.42 1.42L10.59 12l-5.3 5.29a1 1 0 0 0 1.42 1.42L12 13.41l5.29 5.3a1 1 0 0 0 1.42-1.42Z"></path>
          </svg>
        </button>
      </form>
    </div>
  </div>
</div>
 </div>

  {{ footer({
    meta: {
      items: [
        {
          href: "/",
          text: "Home"
        },
        {
          href: "/example-templates",
          text: "Page templates"
        },
        {
          href: "/prototype-admin/reset?returnPage=" + (currentPage | urlencode),
          text: "Reset data"
        }
      ]
    }
  }) }}
{% endblock %}

{% block bodyEnd %}
    <script type="module">
      import { initAll } from '/nhsuk-frontend/nhsuk-frontend.min.js'
      initAll()
    </script>
    <script>
      let lastFocus = null;

      function closeDialog() {
        const dialog = document.querySelector('.dialog[aria-hidden="false"]');
        if (dialog) {
          dialog.setAttribute('aria-hidden', 'true');
          const content = dialog.querySelector('.dialog-content');
          content.setAttribute('tabindex', '0');
          if (lastFocus) {
            lastFocus.focus();
            lastFocus = null;
          }
        }
      }

      function initDialogHandlers() {
        // Log out link click handler
        document.addEventListener('click', function(e) {
          // Check for data-toggle attribute first (fallback method)
          let triggerLink = e.target.closest('a[data-toggle="dialog"]');
          
          // If not found, check if this is the "Log out" link in the header account menu
          if (!triggerLink && e.target.textContent.trim() === 'Log out' && e.target.tagName === 'A') {
            triggerLink = e.target;
          }
          
          if (triggerLink) {
            e.preventDefault();
            e.stopPropagation();
            lastFocus = triggerLink;
            const dialog = document.getElementById('dialog-signOut');
            if (dialog) {
              dialog.setAttribute('aria-hidden', 'false');
              const content = dialog.querySelector('.dialog-content');
              content.focus();
            }
            return;
          }

          // Close button handler
          if (e.target.closest('.dialog-close')) {
            e.preventDefault();
            e.stopPropagation();
            closeDialog();
            return;
          }

          // No button handler
          if (e.target.closest('#logoutNo')) {
            e.preventDefault();
            e.stopPropagation();
            closeDialog();
            return;
          }

          // Close when clicking outside dialog
          if (e.target.classList.contains('dialog') && e.target.getAttribute('aria-hidden') === 'false') {
            closeDialog();
          }
        });

        // Escape key handler
        document.addEventListener('keyup', function(e) {
          if (e.key === 'Escape') {
            closeDialog();
          }
        });
      }
     
      // Initialize immediately
      initDialogHandlers();
    </script>
  {% block scripts %}
    <!-- Custom JavaScript files can be added to this file -->
    {% include "includes/scripts.html" %}
    <!-- For adding page specific JavaScript -->
    {% block pageScripts %}{% endblock %}
  {% endblock %}
{% endblock %}
