{% extends 'layout-public.html' %}

{% block pageTitle %}
Task list
{% endblock %}

{% block content %}
<div class="nhsuk-grid-row">
  <div class="nhsuk-grid-column-two-thirds">

    <h1 class="nhsuk-heading-l">Travel and Dual Accommodation Expenses task list</h1>

    <h2 class="nhsuk-heading-s nhsuk-u-margin-bottom-2">There are incomplete tasks</h2>
      <p class="nhsuk-body nhsuk-u-margin-bottom-7">You have completed <span id="completedCount">0</span> of <span id="sectionLength">5</span> sections.</p>

    <h2 class="nhsuk-heading-m">1. Claim overview</h2>
    <ul class="nhsuk-task-list">
      <li class="nhsuk-task-list__item nhsuk-task-list__item--with-link">
        <div class="nhsuk-task-list__name-and-hint">
          <a class="nhsuk-link nhsuk-task-list__link" href="TDAE-eligibility-cya"
            aria-describedby="claim-overview-status">
            Claim overview
          </a>
        </div>
        <div class="nhsuk-task-list__status nhsuk-task-list__status--completed" id="claim-overview-status">
          Completed
        </div>
      </li>
    </ul>

    <h2 class="nhsuk-heading-m">2. Travel costs</h2>
    <ul class="nhsuk-task-list">
      <li class="nhsuk-task-list__item nhsuk-task-list__item--with-link">
        <div class="nhsuk-task-list__name-and-hint">
          <a class="nhsuk-link nhsuk-task-list__link" href="{% if data['dsa-details'] === 'completed' %}
                 TDAE-dsa-taxi/cya-multiple
               {% else %}
                 TDAE-dsa-taxi/pause
               {% endif %}" aria-describedby="taxi-status">
            Taxi details and evidence
          </a>
        </div>

        {% if data['dsa-details'] === 'completed' %}
        <div class="nhsuk-task-list__status nhsuk-task-list__status--completed" id="taxi-status">
          Completed
        </div>
        {% else %}
        <div class="nhsuk-task-list__status" id="taxi-status">
          <strong class="nhsuk-tag nhsuk-tag--white">Not started</strong>
        </div>
        {% endif %}
      </li>
    </ul>

    <h2 class="nhsuk-heading-m">3. Placement timesheets</h2>
    <ul class="nhsuk-task-list">
      <li class="nhsuk-task-list__item nhsuk-task-list__item--with-link">
        <div class="nhsuk-task-list__name-and-hint">
          <a class="nhsuk-link nhsuk-task-list__link" href="TDAE-timesheets/timesheets-evidence-overview-optional"
            aria-describedby="timesheets-status">
            Placement timesheets evidence (optional)
          </a>
        </div>

        {% if data['timesheets-task'] === 'completed' %}
        <div class="nhsuk-task-list__status nhsuk-task-list__status--completed" id="timesheets-status">
          Completed
        </div>
        {% elif data['timesheets-task'] === 'in-progress' %}
        <div class="nhsuk-task-list__status" id="timesheets-status">
          <strong class="nhsuk-tag nhsuk-tag--blue">Task started</strong>
        </div>
        {% else %}
        <div class="nhsuk-task-list__status" id="timesheets-status">
          <strong class="nhsuk-tag nhsuk-tag--white">Not started</strong>
        </div>
        {% endif %}
      </li>
    </ul>

    <h2 class="nhsuk-heading-m">4. Submit claim</h2>
    <ul class="nhsuk-task-list">
      <li class="nhsuk-task-list__item
      {% if data['dsa-details'] === 'completed' %}
        nhsuk-task-list__item--with-link
      {% endif %}">
        <div class="nhsuk-task-list__name-and-hint">
          {% if data['dsa-details'] === 'completed' %}
          <a class="nhsuk-link nhsuk-task-list__link" href="TDAE-placement-cost-summary-dsa"
            aria-describedby="submit-status">
            Submit your claim
          </a>
          {% else %}
          <div>Submit your claim</div>
          {% endif %}
        </div>

        {% if data['submit-claim'] === 'completed' %}
        <div class="nhsuk-task-list__status nhsuk-task-list__status--completed" id="submit-status">
          Completed
        </div>
        {% elif data['dsa-details'] === 'completed' %}
        <div class="nhsuk-task-list__status" id="submit-status">
          <strong class="nhsuk-tag nhsuk-tag--white">Not started</strong>
        </div>
        {% else %}
        <div class="nhsuk-task-list__status nhsuk-task-list__status--cannot-start-yet" id="submit-status">
          Cannot start yet
        </div>
        {% endif %}
      </li>
    </ul>

    <p><a href="TDAE-returning-student/academic-year-details">Save and come back later</a></p>

    {% if data['submit-claim'] != 'completed' %}
    <h2 class="nhsuk-heading-m">Delete claim</h2>
    <p>If you've made a mistake or no longer want to submit this claim, you can <a
        href="TDAE-signpost/TDAE-delete-check">delete this claim</a>.</p>
    {% endif %}

  </div>
</div>
{% endblock %}
{% block pageScripts %}
<script>
  // Get all section headings
  const allHeadings = document.querySelectorAll('h2.nhsuk-heading-m');

  // Only keep headings that are followed by a task list
  const taskSections = Array.from(allHeadings).filter(heading => {
    const next = heading.nextElementSibling;
    return next && next.classList.contains('nhsuk-task-list');
  });

  const completedCountEl = document.getElementById('completedCount');
  const totalCountEl = document.getElementById('sectionLength');

  let completedSections = 0;

  taskSections.forEach(section => {
    // Each valid section is followed by its task list
    const taskList = section.nextElementSibling;

    // If any task in this list is marked as completed,
    // we treat the whole section as completed
    const completedStatus = taskList.querySelector(
      '.nhsuk-task-list__status--completed'
    );

    if (completedStatus) {
      completedSections++;
    }
  });

  // Update the UI counters
  completedCountEl.textContent = completedSections;
  totalCountEl.textContent = taskSections.length;
</script>

<script>
  // JavaScript code
  var currentDateElement = document.getElementById("currentDate");

  // Get the current date
  var currentDate = new Date();

  // Format the date as desired
  var options = { day: 'numeric', month: 'long', year: 'numeric' };
  var formattedDate = currentDate.toLocaleDateString(undefined, options);

  // Set the formatted date as the content of the element
  currentDateElement.textContent = formattedDate;
</script>
{% endblock %}