{% extends 'layout-public.html' %}

{% block pageTitle %}
Task list
{% endblock %}

{% block content %}
<div class="nhsuk-grid-row">
  <div class="nhsuk-grid-column-two-thirds">

    {% if data['submit-claim'] == 'completed' %}
    {{ backLink({
    "href": "TDAE-returning-student/TDAE-active-claims",
    "text": "Go back"
    }) }}
    {% endif %}

    <h1 class="nhsuk-heading-l">Travel and Dual Accommodation Expenses task list</h1>

    <h2 class="nhsuk-heading-s nhsuk-u-margin-bottom-2">
      Claim tasks incomplete
    </h2>

    <!-- JS will calculate both numbers -->
    <p class="nhsuk-body nhsuk-u-margin-bottom-7">
      You have completed <span id="completedCount">0</span> of
      <span id="sectionLength">0</span> sections.
    </p>

    <!-- ========================= -->
    <!-- 1. CLAIM OVERVIEW -->
    <!-- ========================= -->
    <h2 class="nhsuk-heading-m">1. Claim overview</h2>

    <ul class="nhsuk-task-list section">
      <li class="nhsuk-task-list__item nhsuk-task-list__item--with-link">
        <div class="nhsuk-task-list__name-and-hint">
          <a class="nhsuk-task-list__link" href="TDAE-eligibility-cya">
            Claim overview
          </a>
        </div>

        {% if data['change'] == 'yes' %}
        <div class="nhsuk-task-list__status">
          <strong class="nhsuk-tag nhsuk-tag--yellow task-status">
            Action needed
          </strong>
        </div>
        {% else %}
        <div class="nhsuk-task-list__status nhsuk-task-list__status--completed">
          <span class="task-status">Completed</span>
        </div>
        {% endif %}
      </li>
    </ul>

    <!-- ========================= -->
    <!-- 2. TRAVEL COSTS -->
    <!-- ========================= -->
    <h2 class="nhsuk-heading-m">2. Travel costs</h2>

    <ul class="nhsuk-task-list section">
      <li class="nhsuk-task-list__item nhsuk-task-list__item--with-link">
        <div class="nhsuk-task-list__name-and-hint">
          <a class="nhsuk-task-list__link" href="TDAE-normal-summary-cya">
            University travel details
          </a>
        </div>
        <div class="nhsuk-task-list__status">
          <strong class="nhsuk-tag nhsuk-tag--white task-status">
            Not started
          </strong>
        </div>
      </li>

      <li class="nhsuk-task-list__item nhsuk-task-list__item--with-link">
        <div class="nhsuk-task-list__name-and-hint">
          <a class="nhsuk-task-list__link" href="TDAE-placement-same-start-date">
            Placement travel details
          </a>
        </div>
        <div class="nhsuk-task-list__status">
          <strong class="nhsuk-tag nhsuk-tag--blue task-status">
            Task started
          </strong>
        </div>
      </li>
    </ul>

    <!-- ========================= -->
    <!-- 3. ACCOMMODATION COSTS -->
    <!-- ========================= -->
    <h2 class="nhsuk-heading-m">3. Accommodation costs</h2>

    <ul class="nhsuk-task-list section">
      <li class="nhsuk-task-list__item nhsuk-task-list__item--with-link">
        <div class="nhsuk-task-list__name-and-hint">
          <a class="nhsuk-task-list__link" href="TDAE-accommodation-term-time-costs">
            Accommodation details and evidence
          </a>
        </div>
        <div class="nhsuk-task-list__status">
          <strong class="nhsuk-tag nhsuk-tag--white task-status">
            Not started
          </strong>
        </div>
      </li>
    </ul>

    <!-- ========================= -->
    <!-- 4. OVERSEAS COSTS -->
    <!-- ========================= -->
    <h2 class="nhsuk-heading-m">4. Overseas costs</h2>

    <ul class="nhsuk-task-list section">
      <li class="nhsuk-task-list__item nhsuk-task-list__item--with-link">
        <div class="nhsuk-task-list__name-and-hint">
          <a class="nhsuk-task-list__link" href="TDAE-overseas/authorisation">
            Overseas costs details and evidence
          </a>
        </div>
        <div class="nhsuk-task-list__status">
          <strong class="nhsuk-tag nhsuk-tag--white task-status">
            Not started
          </strong>
        </div>
      </li>
    </ul>

    <!-- ========================= -->
    <!-- 5. PLACEMENT TIMESHEETS -->
    <!-- ========================= -->
    <h2 class="nhsuk-heading-m">5. Placement timesheets</h2>

    <ul class="nhsuk-task-list section">
      <li class="nhsuk-task-list__item nhsuk-task-list__item--with-link">
        <div class="nhsuk-task-list__name-and-hint">
          <a class="nhsuk-task-list__link" href="TDAE-timesheets/timesheets-evidence-overview-optional">
            Placement timesheets evidence (optional)
          </a>
        </div>
        <div class="nhsuk-task-list__status">
          <strong class="nhsuk-tag nhsuk-tag--white task-status">
            Not started
          </strong>
        </div>
      </li>
    </ul>

    <!-- ========================= -->
    <!-- 6. SUBMIT CLAIM -->
    <!-- ========================= -->
    <h2 class="nhsuk-heading-m">6. Submit claim</h2>

    <ul class="nhsuk-task-list section">
      <li class="nhsuk-task-list__item nhsuk-task-list__item--with-link">
        <div class="nhsuk-task-list__name-and-hint">
          <a class="nhsuk-task-list__link" href="TDAE-placement-cost-summary">
            Submit your claim
          </a>
        </div>
        <div class="nhsuk-task-list__status">
          <strong class="nhsuk-tag nhsuk-tag--white task-status">
            Not started
          </strong>
        </div>
      </li>
    </ul>

    <p>
      <a href="TDAE-returning-student/academic-year-details">
        Save and come back later
      </a>
    </p>

    <h2 class="nhsuk-heading-m">Delete claim</h2>
    <p>
      If you've made a mistake or no longer want to submit this claim,
      you can <a href="TDAE-signpost/TDAE-delete-check">delete this claim</a>.
    </p>

  </div>
</div>
{% endblock %}

{% block pageScripts %}
<script>
  // SECTION COUNTER (NHS TASK LIST VERSION)
  //
  // Rules:
  // - Each `.nhsuk-task-list.section` = ONE section
  // - A section is completed only if ALL `.task-status` values === "Completed"

  const sections = document.querySelectorAll('.nhsuk-task-list.section');

  let completedSections = 0;

  sections.forEach(section => {
    const statuses = section.querySelectorAll('.task-status');

    const isComplete = Array.from(statuses).every(status =>
      status.textContent.trim() === 'Completed'
    );

    if (isComplete) {
      completedSections++;
    }
  });

  document.getElementById('completedCount').textContent = completedSections;
  document.getElementById('sectionLength').textContent = sections.length;
</script>
{% endblock %}