{% extends 'layout-public.html' %}

{% block pageTitle %}
Task list
{% endblock %}

{% block content %}
<div class="nhsuk-grid-row">
  <div class="nhsuk-grid-column-two-thirds">

    {% if data['submit-claim'] == 'completed' %}
    {{ backLink({
    "href": "TDAE-returning-student/TDAE-active-claims",
    "text": "Go back"
    }) }}
    {% endif %}

    {% if data['submit-claim'] != 'completed' %}
    <h1 class="nhsuk-heading-l">Travel and Dual Accommodation Expenses task list</h1>
    {% else %}
    <h1 class="nhsuk-heading-l nhsuk-u-margin-bottom-9">
      Travel and Dual Accommodation Expenses task list
    </h1>
    {% endif %}

    <div class="nhsuk-warning-callout">
      <h3 class="nhsuk-warning-callout__label">
        <span role="text">
          <span class="nhsuk-u-visually-hidden">Important: </span>
          University feedback
        </span>
      </h3>
      <p>This is the comment left by the University when returning to student.</p>
    </div>

    <details class="nhsuk-details nhsuk-expander nhsuk-u-margin-top-0">
      <summary class="nhsuk-details__summary">
        <span class="nhsuk-details__summary-text">
          Claim notes and history
        </span>
      </summary>
      <div class="nhsuk-details__text">
        <table class="nhsuk-table-responsive">
          <thead class="nhsuk-table__head">
            <tr>
              <th scope="col">From</th>
              <th scope="col">Date</th>
              <th scope="col">Notes</th>
            </tr>
          </thead>
          <tbody class="nhsuk-table__body">
            <tr class="nhsuk-table__row">
              <td class="nhsuk-table__cell">
                {% if data['name'] %}{{ data['name'] }}{% else %}Joe Bloggs{% endif %}
              </td>
              <td class="nhsuk-table__cell">5 August 2024</td>
              <td class="nhsuk-table__cell"><strong>Claim submitted</strong></td>
            </tr>
            <tr class="nhsuk-table__row">
              <td class="nhsuk-table__cell">Jeremy Bellingham (University)</td>
              <td class="nhsuk-table__cell"><span id="currentDate"></span></td>
              <td class="nhsuk-table__cell">
                <strong>Returned to student</strong><br>
                The evidence uploaded for insurance is the same as the evidence uploaded for visa fees.
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </details>

    {% if data['submit-claim'] != 'completed' %}
    <h2 class="nhsuk-heading-s nhsuk-u-margin-bottom-2">There are incomplete tasks</h2>
    <p class="nhsuk-body nhsuk-u-margin-bottom-7">
      You have completed <span id="completedCount">0</span> of
      <span id="sectionLength">5</span> sections.
    </p>
    {% endif %}

    <!-- 1. Claim overview -->
    <h2 class="nhsuk-heading-m">1. Claim overview</h2>
    <ul class="nhsuk-task-list section-item">
      <li class="nhsuk-task-list__item nhsuk-task-list__item--with-link">
        <div class="nhsuk-task-list__name-and-hint">
          <a class="nhsuk-task-list__link" href="TDAE-eligibility-cya">
            Claim overview
          </a>
        </div>
        <div class="nhsuk-task-list__status task-status">
          Completed
        </div>
      </li>
    </ul>

    <!-- 2. Travel costs -->
    <h2 class="nhsuk-heading-m">2. Travel costs</h2>
    <ul class="nhsuk-task-list section-item">

      {% set travelTasks = [
      ["../TDAE-normal-summary-cya?university-details=action", "University travel details"],
      ["../TDAE-placement-itinerary?claiming-for=Public transport&placement-details=action", "Placement travel
      details"],
      ["../TDAE-evidence-cya?evidenceNumber=2&evidence-details=action", "Placement travel evidence (one period)"],
      ["../TDAE-evidence-pause-multiple?week-1=completed&week-2=completed&evidence-details=action", "Placement travel
      evidence (multiple periods)"],
      ["../TDAE-taxi/check-multiple?taxi-details=action", "Taxi details and evidence"],
      ["../TDAE-hire-car-check-multiple?hire-car-details=action", "Hire car details and evidence"]
      ] %}

      {% for task in travelTasks %}
      <li class="nhsuk-task-list__item nhsuk-task-list__item--with-link">
        <div class="nhsuk-task-list__name-and-hint">
          <a class="nhsuk-task-list__link" href="{{ task[0] }}">
            {{ task[1] }}
          </a>
        </div>
        <div class="nhsuk-task-list__status task-status">
          <strong class="nhsuk-tag nhsuk-tag--yellow">Action needed</strong>
        </div>
      </li>
      {% endfor %}
    </ul>

    <!-- 3. Accommodation costs -->
    <h2 class="nhsuk-heading-m">3. Accommodation costs</h2>
    <ul class="nhsuk-task-list section-item">
      <li class="nhsuk-task-list__item nhsuk-task-list__item--with-link">
        <div class="nhsuk-task-list__name-and-hint">
          <a class="nhsuk-task-list__link" href="../TDAE-accommodation-check-multiple?accommodation-details=action">
            Accommodation details and evidence
          </a>
        </div>
        <div class="nhsuk-task-list__status task-status">
          <strong class="nhsuk-tag nhsuk-tag--yellow">Action needed</strong>
        </div>
      </li>

      <li class="nhsuk-task-list__item nhsuk-task-list__item--with-link">
        <div class="nhsuk-task-list__name-and-hint">
          <a class="nhsuk-task-list__link"
            href="../accommodation-journey/TDAE-accommodation-travel-check-multiple?accommodation-travel-details=action">
            Accommodation travel details
          </a>
        </div>
        <div class="nhsuk-task-list__status task-status">
          <strong class="nhsuk-tag nhsuk-tag--yellow">Action needed</strong>
        </div>
      </li>
    </ul>

    <!-- 4. Overseas costs -->
    <h2 class="nhsuk-heading-m">4. Overseas costs</h2>
    <ul class="nhsuk-task-list section-item">
      <li class="nhsuk-task-list__item nhsuk-task-list__item--with-link">
        <div class="nhsuk-task-list__name-and-hint">
          <a class="nhsuk-task-list__link"
            href="../TDAE-overseas/overseas-check-2?overseas-cost=insurance&overseas-cost=visa-fees&overseas-details=action">
            Overseas costs details and evidence
          </a>
        </div>
        <div class="nhsuk-task-list__status task-status">
          <strong class="nhsuk-tag nhsuk-tag--yellow">Action needed</strong>
        </div>
      </li>
    </ul>

    <!-- 5. Submit claim -->
    <h2 class="nhsuk-heading-m">5. Submit claim</h2>
    <ul class="nhsuk-task-list section-item">
      <li class="nhsuk-task-list__item nhsuk-task-list__item--with-link">
        <div class="nhsuk-task-list__name-and-hint">
          <a class="nhsuk-task-list__link" href="TDAE-placement-cost-summary">
            Submit your claim
          </a>
        </div>
        <div class="nhsuk-task-list__status task-status">
          Not started
        </div>
      </li>
    </ul>

    <p>
      <a href="TDAE-returning-student/academic-year-details">
        Save and come back later
      </a>
    </p>

  </div>
</div>
{% endblock %}

{% block pageScripts %}
<script>
  // Section completion counter logic
  const containers = document.querySelectorAll('.section-item');
  const containerValues = {};

  containers.forEach((container, index) => {
    containerValues[index] = 1;
    container.querySelectorAll('.task-status').forEach(status => {
      if (status.textContent.trim() !== 'Completed') {
        containerValues[index] = 0;
      }
    });
  });

  document.getElementById('completedCount').innerHTML =
    Object.values(containerValues).reduce((a, b) => a + b, 0);
  document.getElementById('sectionLength').innerHTML = containers.length;
</script>

<script>
  // Current date for history table
  const el = document.getElementById("currentDate");
  if (el) {
    el.textContent = new Date().toLocaleDateString(undefined, {
      day: 'numeric',
      month: 'long',
      year: 'numeric'
    });
  }
</script>
{% endblock %}