{% extends 'layout-public.html' %}

{% block pageTitle %}
Task list
{% endblock %}

{% block content %}
<div class="nhsuk-grid-row">
    <div class="nhsuk-grid-column-two-thirds">

        {{ backLink({
        "href": "javascript:history.go(-1)",
        "text": "Go back"
        }) }}

        <h1 class="nhsuk-heading-l">Travel and Dual Accommodation Expenses task list</h1>

        <div class="nhsuk-inset-text">
            <span class="nhsuk-u-visually-hidden">Information: </span>
            <h2 class="nhsuk-heading-s nhsuk-u-margin-bottom-2">Claim tasks incomplete</h2>
            <p>Before you can submit your claim you must first complete tasks 1 to 4.</p>
            <p class="nhsuk-body">
                You have completed <span id="completedCount">0</span> of <span id="sectionLength">4</span> sections.
            </p>
        </div>

        <!-- 1 -->
        <h2 class="nhsuk-heading-m">1. Eligible to claim online</h2>
        <ul class="nhsuk-task-list section-item">
            <li class="nhsuk-task-list__item nhsuk-task-list__item--with-link">
                <div class="nhsuk-task-list__name-and-hint">
                    <a class="nhsuk-task-list__link" href="TDAE-student-university-details">
                        Check online eligibility
                    </a>
                </div>
                <div class="nhsuk-task-list__status nhsuk-task-list__status--completed task-status">
                    Completed
                </div>
            </li>
        </ul>

        <!-- 2 -->
        <h2 class="nhsuk-heading-m">2. University details</h2>
        <ul class="nhsuk-task-list section-item">
            <li class="nhsuk-task-list__item nhsuk-task-list__item--with-link">
                <div class="nhsuk-task-list__name-and-hint">
                    <a class="nhsuk-task-list__link" href="TDAE-same-term time-address">
                        Provide university details
                    </a>
                </div>
                <div class="nhsuk-task-list__status nhsuk-task-list__status--completed task-status">
                    Completed
                </div>
            </li>
        </ul>

        <!-- 3 -->
        <h2 class="nhsuk-heading-m">3. Placement details</h2>
        <ul class="nhsuk-task-list section-item">
            <li class="nhsuk-task-list__item nhsuk-task-list__item--with-link">
                <div class="nhsuk-task-list__name-and-hint">
                    <a class="nhsuk-task-list__link" href="TDAE-placement-return-mileage">
                        Provide claim details
                    </a>
                </div>
                <div class="nhsuk-task-list__status nhsuk-task-list__status--completed task-status">
                    Completed
                </div>
            </li>
        </ul>

        <!-- 4 -->
        <h2 class="nhsuk-heading-m">4. Claim date and evidence</h2>
        <ul class="nhsuk-task-list section-item">
            <li class="nhsuk-task-list__item nhsuk-task-list__item--with-link">
                <div class="nhsuk-task-list__name-and-hint">
                    <a class="nhsuk-task-list__link" href="../TDAE-evidence-section-cya">
                        Upload your evidence
                    </a>
                </div>

                {% if data['action-required'] === 'no' %}
                <div class="nhsuk-task-list__status nhsuk-task-list__status--completed task-status">
                    Completed
                </div>
                {% else %}
                <div class="nhsuk-task-list__status task-status">
                    <strong class="nhsuk-tag nhsuk-tag--yellow">Action required</strong>
                </div>
                {% endif %}
            </li>
        </ul>

        <!-- 5 -->
        <h2 class="nhsuk-heading-m">5. Submit claim</h2>
        <ul class="nhsuk-task-list">
            <li class="nhsuk-task-list__item
        {% if data['action-required'] === 'no' %}
          nhsuk-task-list__item--with-link
        {% endif %}">
                <div class="nhsuk-task-list__name-and-hint">
                    {% if data['action-required'] === 'no' %}
                    <a class="nhsuk-task-list__link" href="../TDAE-placement-cost-summary">
                        Submit your claim
                    </a>
                    {% else %}
                    <span>Submit your claim</span>
                    {% endif %}
                </div>
                <div class="nhsuk-task-list__status nhsuk-task-list__status--cannot-start-yet">
                    Cannot start yet
                </div>
            </li>
        </ul>

    </div>
</div>
{% endblock %}

{% block pageScripts %}
<script>
    // Count completed sections:
    // A section is complete only if ALL task-status elements inside it say "Completed"
    const sections = document.querySelectorAll('.section-item');
    let completed = 0;

    sections.forEach(section => {
        const statuses = section.querySelectorAll('.task-status');
        let allComplete = true;

        statuses.forEach(status => {
            if (status.textContent.trim() !== 'Completed') {
                allComplete = false;
            }
        });

        if (allComplete) completed++;
    });

    document.getElementById('completedCount').textContent = completed;
    document.getElementById('sectionLength').textContent = sections.length;
</script>
{% endblock %}